<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>HTML, CSS, JavaScript</title>
  </head>

  <body>
    <main class="container">
      <section class="section section_1">Section 1</section>
      <section class="section section_1">Section 1</section>
      <section class="section section_2">
        <div class="circle">
          <h3>Go Youn Jung</h3>
        </div>
      </section>
      <section class="section section_3">Section 3</section>
      <section class="section section_3">Section 3</section>
    </main>

    <script>
      const section = document.querySelector(".section_2");
      let currentY = section.getBoundingClientRect().y;
      let prevY = section.getBoundingClientRect().y;
      const circle = section.querySelector(".circle");

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            const {
              target,
              isIntersecting,
              intersectionRatio,
              intersectionRect,
              boundingClientRect,
            } = entry;

            currentY = boundingClientRect.y;

            /***
             *  အောက်က content တွေမြင်ရအောင် scroll ဆွဲရင် scroll down
             *  အပေါ်က content တွေမြင်ရအောင် scroll ဆွဲရင် scroll up
             **/
            // if (currentY < prevY) {
            //   console.log("scrolling down", intersectionRatio);
            //   circle.style.transform = `scale(${intersectionRatio})`;
            //   circle.style.opacity = intersectionRatio;
            //   if (intersectionRatio < 1) {
            //     circle.style.transform = `scale(1)`;
            //     circle.style.opacity = 1;
            //   } else {
            //     circle.style.transform = `scale(${intersectionRatio})`;
            //     circle.style.opacity = intersectionRatio;
            //   }
            // }

            // Intersection Observer is not good for scroll bound element because the callback won't be executed when the element is completely visible inside the root

            if (intersectionRatio < 1) {
              if (currentY < prevY) {
                // down

                circle.style.transform = `translateX(${
                  intersectionRatio * 400
                }px) scale(${intersectionRatio})`;
                circle.style.opacity = intersectionRatio;
              }

              if (currentY > prevY) {
                // up
                console.log("scroll up", intersectionRatio);
                circle.style.transform = `translateX(0) scale(1)`;
                circle.style.opacity = 1;
              }
            }

            prevY = currentY;
          });
        },
        {
          threshold: buildThreshold(862),
        }
      );

      observer.observe(section);
      function buildThreshold(steps) {
        return new Array(steps).fill(0).map((_, idx) => idx / steps);
      }
    </script>
  </body>
</html>
